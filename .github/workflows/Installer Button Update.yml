# Sample workflow for building and deploying a Hugo site to GitHub Pages
name: 버전 Tag push 시 Config Update

on:
  # Runs on pushes targeting the default branch
  push:
    tags: "*"
    
  workflow_dispatch:
  
  

# Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# Allow only one concurrent deployment, skipping runs queued between the run in-progress and latest queued.
# However, do NOT cancel in-progress runs as we want to allow these production deployments to complete.
concurrency:
  group: "pages"
  cancel-in-progress: false

# Default to bash
defaults:
  run:
    shell: bash

jobs:
  # Build job
  build:
    runs-on: ubuntu-latest
    env:
      HUGO_VERSION: 0.108.0
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Setup Pages
        id: pages
        uses: actions/configure-pages@v3
      - name: Get current git tag
        uses: devops-actions/action-get-tag@v1.0.1
      - name: setup-yq
        uses: mikefarah/yq@v4.33.2
      - name: Change Download
        run: |
          yq -i '.params.hero.button.name = "Install v'${{steps.tag.outputs.tag}}'"' config.yaml
          yq -i '.params.hero.button.url = "https://github.com/yunwoopc-dev/Release/releases/download/'${{steps.tag.outputs.tag}}'/Hub-'${{steps.tag.outputs.tag}}'.exe"' config.yaml
          echo $SOURCE_TAG
        env:
          SOURCE_TAG: ${{ steps.branch_name.outputs.SOURCE_TAG }}
      - name: Git Commit and Push
        # You may pin to the exact commit or the version.
        # uses: github-actions-x/commit@722d56b8968bf00ced78407bbe2ead81062d8baa
        uses: github-actions-x/commit@v2.9
        with:
          # Github Token with commit access
          github-token: ${{ secrets.GITHUB_TOKEN }}
          # Override branch to push to
          push-branch: dev
          # Specify commit message
          commit-message: "${{steps.tag.outputs.tag}} Download Button Updated"
